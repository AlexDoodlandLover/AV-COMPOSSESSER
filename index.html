<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Video Composesser‚Ñ¢</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
  body {
    background: #24170c;
    color: #f3deb3;
    font-family: monospace;
    text-align: center;
    padding: 16px;
  }

  h1 {
    font-size: 1.6em;
  }

  input, button {
    font-size: 1.1em;
    margin-top: 12px;
  }

  button {
    background: #6b4f2c;
    color: white;
    border: none;
    padding: 12px 18px;
    cursor: pointer;
  }

  video {
    width: 100%;
    max-width: 320px;
    border: 6px solid #b08d57;
    margin-top: 20px;
  }

  .hint {
    font-size: 0.9em;
    opacity: 0.8;
  }
</style>
</head>

<body>

<h1>üéûÔ∏è Video Composesser‚Ñ¢</h1>
<p class="hint">Intentionally ruins videos. Permanently.</p>

<input type="file" id="upload" accept="video/*"><br>
<button onclick="composess()">Composess Video</button>

<video id="preview" controls hidden></video>

<script type="module">
import { createFFmpeg, fetchFile } from "https://unpkg.com/@ffmpeg/ffmpeg@0.12.6/dist/ffmpeg.min.js";

const ffmpeg = createFFmpeg({ log: false });

const isMobile = /Android|iPhone|iPad|iPod/i.test(navigator.userAgent);
const preview = document.getElementById("preview");

if (!isMobile) preview.hidden = false;

async function composess() {
  if (!ffmpeg.isLoaded()) await ffmpeg.load();

  const file = document.getElementById("upload").files[0];
  if (!file) {
    alert("give me a video to destroy");
    return;
  }

  ffmpeg.FS("writeFile", "input.mp4", await fetchFile(file));

  await ffmpeg.run(
    "-i", "input.mp4",

    // visual violence
    "-vf", "scale=128:96:flags=neighbor,eq=contrast=1.4:saturation=0.5,noise=alls=20:allf=t+u",

    // time damage
    "-r", "10",

    // ancient codec
    "-c:v", "mpeg1video",
    "-b:v", "180k",
    "-g", "5",
    "-q:v", "31",

    // audio abuse
    "-ar", "8000",
    "-ac", "1",
    "-b:a", "32k",

    "video_composessed.mpg"
  );

  const data = ffmpeg.FS("readFile", "video_composessed.mpg");
  const blob = new Blob([data.buffer], { type: "video/mpeg" });
  const url = URL.createObjectURL(blob);

  if (isMobile) {
    const a = document.createElement("a");
    a.href = url;
    a.download = "video_composessed.mpg";
    document.body.appendChild(a);
    a.click();
    document.body.removeChild(a);
  } else {
    preview.src = url;
  }
}
</script>

</body>
</html>
